<!DOCTYPE html>
<html lang="en" dir="ltr">
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
    <meta charset="utf-8">
    <title>Resizable Layout</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --background-color: #fff;
            --text-color: #000;
            --header-background: #666;
            --header-color: #fff;
            --border-color: #ccc;
            --resize-handle-color: #888;
            box-sizing: border-box;
            font-family: "Lexend", "Helvetica Neue", "Helvetica", sans-serif;
            font-size: 18px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* Mobile and tablet responsive styles */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100% !important;
                min-width: unset;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }

            .nav-content {
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                overflow-y: visible;
                padding: 0.5rem;
            }

            .nav-item {
                flex-shrink: 0;
                margin: 0 0.25rem;
                padding: 0.5rem 1rem;
                white-space: nowrap;
            }

            .main-content {
                flex: 1;
                min-height: 0;
            }

            .content-area {
                height: 100%;
            }

            .item-list {
                min-height: 150px;
            }

            .sidebar-resize,
            .list-resize {
                display: none;
            }

            .resize-handle {
                display: none;
            }
        }

        @media (max-width: 480px) {
            :root {
                font-size: 16px;
            }

            .header {
                padding: 0.75rem;
                font-size: 1.1rem;
            }

            .nav-content {
                padding: 0.25rem;
            }

            .nav-item {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }

            .list-header,
            .detail-header {
                padding: 0.75rem;
                font-size: 1rem;
            }

            .list-content,
            .detail-content {
                padding: 0.75rem;
            }

            .list-item {
                padding: 0.6rem;
                font-size: 0.9rem;
            }

            .item-list {
                min-height: 120px;
            }

            th, td {
                padding: 0.4rem;
                font-size: 0.85rem;
            }
        }

        .header {
            background-color: var(--header-background);
            color: var(--header-color);
            padding: 1rem;
            font-weight: 600;
            font-size: 1.2rem;
            border-bottom: 3px solid #333;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            min-width: 200px;
            width: 300px;
            background-color: #f5f5f5;
            border-right: 1px solid var(--border-color);
            position: relative;
        }

        .nav-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .nav-item {
            padding: 0.5rem;
            margin: 0.25rem 0;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .nav-item:hover {
            background-color: #e0e0e0;
        }

        .nav-item.active {
            background-color: var(--header-background);
            color: var(--header-color);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            min-height: 200px;
            height: 50%;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .list-header {
            background-color: #f8f8f8;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }

        .list-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .list-item {
            padding: 0.75rem;
            margin: 0.25rem 0;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .list-item:hover {
            background-color: #f0f0f0;
            border-color: #ccc;
        }

        .list-item.selected {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }

        .item-detail {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .detail-header {
            background-color: #f8f8f8;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }

        .detail-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .resize-handle {
            position: absolute;
            background-color: var(--resize-handle-color);
            user-select: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .resize-handle:hover,
        .resize-handle.resizing {
            opacity: 1;
        }

        .sidebar-resize {
            top: 0;
            right: -2px;
            width: 4px;
            height: 100%;
            cursor: col-resize;
        }

        .list-resize {
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 4px;
            cursor: row-resize;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            text-align: left;
        }

        th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
            font-style: italic;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .item-subtitle {
            font-size: 0.9rem;
            color: #666;
        }

        .detail-section {
            padding: 1rem 0;
        }

        .detail-section h3 {
            margin: 0 0 1rem 0;
            color: var(--header-background);
        }

        .detail-section p {
            margin: 0.5rem 0;
        }

        .status-saved { color: #666; }
        .status-applied { color: #2196f3; }
        .status-interviewing { color: #ff9800; }
        .status-offered { color: #4caf50; }
        .status-rejected { color: #f44336; }
        .status-accepted { color: #4caf50; font-weight: bold; }
        .status-declined { color: #f44336; }
        .status-success { color: #4caf50; font-weight: bold; }
        .status-error { color: #f44336; font-weight: bold; }

        /* Modal Styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-backdrop.hidden {
            display: none;
        }

        .modal {
            background-color: white;
            border-radius: 8px;
            max-width: 90vw;
            max-height: 90vh;
            width: 600px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .large-modal {
            width: 90vw;
            max-width: 1200px;
            height: 90vh;
        }

        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--header-background);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: #666;
        }

        .modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .modal-footer {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f8f8;
        }

        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab:hover {
            background-color: #e0e0e0;
        }

        .tab.active {
            background-color: white;
            border-bottom-color: var(--header-background);
            font-weight: 600;
        }

        .panel {
            display: none;
            padding: 1rem;
        }

        .panel.active {
            display: block;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 1.5rem;
        }

        .form-section h4 {
            margin: 0 0 1rem 0;
            color: var(--header-background);
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--header-background);
            box-shadow: 0 0 0 2px rgba(102, 102, 102, 0.1);
        }

        /* Buttons */
        .primary-button {
            background-color: var(--header-background);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        .primary-button:hover {
            background-color: #555;
        }

        .secondary-button {
            background-color: white;
            color: var(--header-background);
            border: 1px solid var(--header-background);
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .secondary-button:hover {
            background-color: var(--header-background);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        /* Warning box */
        .warning-box {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 0.75rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .warning-box i {
            margin-right: 0.5rem;
        }

        /* Cover letter content */
        .cover-letter-content {
            padding: 1rem;
            line-height: 1.6;
            white-space: pre-wrap;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin: 1rem 0;
        }

        /* Settings form styles */
        .form-group small {
            display: block;
            margin-top: 0.25rem;
            color: #666;
            font-size: 0.85rem;
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 0.5rem;
        }

        /* Loading state */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #666;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Resume Editor Styles */
        .resume-section {
            padding: 1rem;
        }

        .resume-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .resume-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--header-background);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group.full-width {
            grid-column: 1 / -1;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #333;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--header-background);
            box-shadow: 0 0 0 2px rgba(102, 102, 102, 0.1);
        }

        .section-list {
            margin-top: 1rem;
        }

        .section-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .section-item-content {
            flex: 1;
        }

        .section-item-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .section-item-subtitle {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .section-item-description {
            color: #777;
            font-size: 0.85rem;
        }

        .section-item-actions {
            display: flex;
            gap: 0.25rem;
        }

        .icon-button {
            background: none;
            border: none;
            padding: 0.25rem;
            cursor: pointer;
            border-radius: 3px;
            color: #666;
            font-size: 0.9rem;
        }

        .icon-button:hover {
            background-color: #e9ecef;
            color: #333;
        }

        .small-button {
            background-color: white;
            color: var(--header-background);
            border: 1px solid var(--header-background);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .small-button:hover {
            background-color: var(--header-background);
            color: white;
        }

        /* Template Selector */
        .template-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .template-selector label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .template-selector select {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.85rem;
        }

        /* Preview Container */
        .preview-container {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: white;
            margin-top: 1rem;
            padding: 1rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Empty state for sections */
        .section-empty {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 4px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar" id="sidebar">
            <div class="header">Resume Tool</div>
            <div class="nav-content">
                <div class="nav-item active" data-category="resumes">Resumes</div>
                <div class="nav-item" data-category="jobs">Jobs</div>
                <div class="nav-item" data-category="logs">API Logs</div>
                <div class="nav-item" data-category="settings">Settings</div>
            </div>
            <div class="resize-handle sidebar-resize" id="sidebarResize"></div>
        </div>

        <div class="main-content">
            <div class="content-area">
                <div class="item-list" id="itemList">
                    <div class="list-header">List of Items</div>
                    <div class="list-content" id="listContent">
                        <div class="empty-state">Select a category from the navigation</div>
                    </div>
                    <div class="resize-handle list-resize" id="listResize"></div>
                </div>

                <div class="item-detail">
                    <div class="detail-header">Item Detail</div>
                    <div class="detail-content" id="detailContent">
                        <div class="empty-state">Select an item to view details</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resume Edit Modal -->
    <div class="modal-backdrop hidden" id="resume-edit-modal">
        <div class="modal large-modal">
            <div class="modal-header">
                <h3>Edit Resume</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="tabs" role="tablist">
                    <div class="tab active" data-tab="basics" role="tab" aria-selected="true">Basics</div>
                    <div class="tab" data-tab="work" role="tab">Work</div>
                    <div class="tab" data-tab="education" role="tab">Education</div>
                    <div class="tab" data-tab="skills" role="tab">Skills</div>
                    <div class="tab" data-tab="projects" role="tab">Projects</div>
                    <div class="tab" data-tab="preview" role="tab">Preview</div>
                </div>
                
                <div id="basics-panel" class="panel active">
                    <div class="resume-section">
                        <div class="resume-section-header">
                            <div class="resume-section-title">Personal Information</div>
                        </div>
                        <div class="form-grid">
                            <div class="input-group">
                                <label for="resume-name">Full Name</label>
                                <input type="text" id="resume-name" placeholder="Your full name">
                            </div>
                            <div class="input-group">
                                <label for="resume-label">Professional Title</label>
                                <input type="text" id="resume-label" placeholder="e.g. Senior Software Engineer">
                            </div>
                            <div class="input-group">
                                <label for="resume-email">Email</label>
                                <input type="email" id="resume-email" placeholder="your.email@example.com">
                            </div>
                            <div class="input-group">
                                <label for="resume-phone">Phone</label>
                                <input type="tel" id="resume-phone" placeholder="(555) 123-4567">
                            </div>
                            <div class="input-group">
                                <label for="resume-website">Website</label>
                                <input type="url" id="resume-website" placeholder="https://yourwebsite.com">
                            </div>
                            <div class="input-group">
                                <label for="resume-city">City</label>
                                <input type="text" id="resume-city" placeholder="San Francisco">
                            </div>
                            <div class="input-group">
                                <label for="resume-region">State/Region</label>
                                <input type="text" id="resume-region" placeholder="CA">
                            </div>
                            <div class="input-group full-width">
                                <label for="resume-summary">Professional Summary</label>
                                <textarea id="resume-summary" rows="4" placeholder="Brief professional summary highlighting your key skills and experience"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="work-panel" class="panel">
                    <div class="resume-section">
                        <div class="resume-section-header">
                            <div class="resume-section-title">Work Experience</div>
                            <button type="button" class="small-button" id="add-work">Add Experience</button>
                        </div>
                        <div id="work-list" class="section-list"></div>
                    </div>
                </div>
                
                <div id="education-panel" class="panel">
                    <div class="resume-section">
                        <div class="resume-section-header">
                            <div class="resume-section-title">Education</div>
                            <button type="button" class="small-button" id="add-education">Add Education</button>
                        </div>
                        <div id="education-list" class="section-list"></div>
                    </div>
                </div>
                
                <div id="skills-panel" class="panel">
                    <div class="resume-section">
                        <div class="resume-section-header">
                            <div class="resume-section-title">Skills</div>
                            <button type="button" class="small-button" id="add-skill">Add Skill</button>
                        </div>
                        <div id="skills-list" class="section-list"></div>
                    </div>
                </div>
                
                <div id="projects-panel" class="panel">
                    <div class="resume-section">
                        <div class="resume-section-header">
                            <div class="resume-section-title">Projects</div>
                            <button type="button" class="small-button" id="add-project">Add Project</button>
                        </div>
                        <div id="projects-list" class="section-list"></div>
                    </div>
                </div>
                
                <div id="preview-panel" class="panel">
                    <div class="resume-section">
                        <div class="resume-section-header">
                            <div class="resume-section-title">Resume Preview</div>
                            <div class="template-selector">
                                <label for="template-select">Template:</label>
                                <select id="template-select">
                                    <option value="basic">Basic</option>
                                    <option value="modern">Modern</option>
                                </select>
                            </div>
                        </div>
                        <div class="preview-container">
                            <resume-json id="resume-preview" template="basic"></resume-json>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button modal-cancel">Cancel</button>
                <button class="primary-button" id="save-resume-changes">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Job Tailoring Modal -->
    <div class="modal-backdrop hidden" id="jobs-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Tailor Resume for Job</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="form-section">
                    <div class="form-group">
                        <label for="job-title">Job Title</label>
                        <input type="text" id="job-title" placeholder="e.g. Senior Software Engineer">
                    </div>
                    <div class="form-group">
                        <label for="job-company">Company</label>
                        <input type="text" id="job-company" placeholder="e.g. Google, Microsoft">
                    </div>
                    <div class="form-group">
                        <label for="job-description">Job Description</label>
                        <textarea id="job-description" rows="10" placeholder="Paste the complete job description here..."></textarea>
                    </div>
                    <div id="api-warning" class="warning-box" style="display: none;">
                        <i class="fa-solid fa-exclamation-triangle"></i>
                        No API service configured. Please configure your API settings first.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button modal-cancel">Cancel</button>
                <button class="primary-button" id="tailor-resume-btn">Tailor Resume</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-backdrop hidden" id="settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="form-section">
                    <h4>AI Service Configuration</h4>
                    <div class="form-group">
                        <label for="api-service">Choose AI Service</label>
                        <select id="api-service">
                            <option value="">Select service...</option>
                            <option value="claude">Claude (Anthropic)</option>
                            <option value="chatgpt">ChatGPT (OpenAI)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="api-key">API Key</label>
                        <input type="password" id="api-key" placeholder="Enter your API key">
                        <small>Your API key is stored locally and never sent to our servers.</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="use-direct-api" checked>
                            Use direct API calls (recommended for security)
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button modal-cancel">Cancel</button>
                <button class="primary-button" id="save-settings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Cover Letter Modal -->
    <div class="modal-backdrop hidden" id="cover-letter-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Cover Letter</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="cover-letter-content" id="cover-letter-content">
                    <!-- Cover letter content will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button" id="copy-cover-letter">Copy to Clipboard</button>
                <button class="primary-button modal-cancel">Close</button>
            </div>
        </div>
    </div>

    <!-- Work Experience Edit Modal -->
    <div class="modal-backdrop hidden" id="work-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Work Experience</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="work-name">Company Name *</label>
                        <input type="text" id="work-name" required>
                    </div>
                    <div class="form-group">
                        <label for="work-position">Position *</label>
                        <input type="text" id="work-position" required>
                    </div>
                    <div class="form-group">
                        <label for="work-startDate">Start Date</label>
                        <input type="date" id="work-startDate">
                    </div>
                    <div class="form-group">
                        <label for="work-endDate">End Date</label>
                        <input type="date" id="work-endDate">
                    </div>
                    <div class="form-group">
                        <label for="work-location">Location</label>
                        <input type="text" id="work-location">
                    </div>
                    <div class="form-group">
                        <label for="work-url">Company Website</label>
                        <input type="url" id="work-url">
                    </div>
                    <div class="form-group full-width">
                        <label for="work-summary">Summary</label>
                        <textarea id="work-summary" rows="3"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label for="work-highlights">Highlights (one per line)</label>
                        <textarea id="work-highlights" rows="4" placeholder="• Achievement 1&#10;• Achievement 2&#10;• Achievement 3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button modal-cancel">Cancel</button>
                <button class="primary-button" id="save-work">Save</button>
            </div>
        </div>
    </div>

    <!-- Education Edit Modal -->
    <div class="modal-backdrop hidden" id="education-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Education</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="education-institution">Institution *</label>
                        <input type="text" id="education-institution" required>
                    </div>
                    <div class="form-group">
                        <label for="education-studyType">Study Type *</label>
                        <input type="text" id="education-studyType" placeholder="Bachelor, Master, PhD, etc." required>
                    </div>
                    <div class="form-group">
                        <label for="education-area">Area of Study</label>
                        <input type="text" id="education-area" placeholder="Computer Science, etc.">
                    </div>
                    <div class="form-group">
                        <label for="education-score">GPA/Score</label>
                        <input type="text" id="education-score" placeholder="3.8, 85%, etc.">
                    </div>
                    <div class="form-group">
                        <label for="education-startDate">Start Date</label>
                        <input type="date" id="education-startDate">
                    </div>
                    <div class="form-group">
                        <label for="education-endDate">End Date</label>
                        <input type="date" id="education-endDate">
                    </div>
                    <div class="form-group full-width">
                        <label for="education-url">Institution Website</label>
                        <input type="url" id="education-url">
                    </div>
                    <div class="form-group full-width">
                        <label for="education-courses">Relevant Courses (one per line)</label>
                        <textarea id="education-courses" rows="3" placeholder="• Data Structures&#10;• Algorithms&#10;• Software Engineering"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button modal-cancel">Cancel</button>
                <button class="primary-button" id="save-education">Save</button>
            </div>
        </div>
    </div>

    <!-- Skills Edit Modal -->
    <div class="modal-backdrop hidden" id="skills-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Skill</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="skill-name">Skill Name *</label>
                        <input type="text" id="skill-name" required placeholder="JavaScript, Project Management, etc.">
                    </div>
                    <div class="form-group">
                        <label for="skill-level">Level</label>
                        <select id="skill-level">
                            <option value="">Select level...</option>
                            <option value="Beginner">Beginner</option>
                            <option value="Intermediate">Intermediate</option>
                            <option value="Advanced">Advanced</option>
                            <option value="Expert">Expert</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="skill-keywords">Keywords (one per line)</label>
                        <textarea id="skill-keywords" rows="4" placeholder="• React&#10;• Node.js&#10;• ES6&#10;• TypeScript"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button modal-cancel">Cancel</button>
                <button class="primary-button" id="save-skill">Save</button>
            </div>
        </div>
    </div>

    <!-- Projects Edit Modal -->
    <div class="modal-backdrop hidden" id="projects-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Project</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="project-name">Project Name *</label>
                        <input type="text" id="project-name" required>
                    </div>
                    <div class="form-group">
                        <label for="project-url">Project URL</label>
                        <input type="url" id="project-url" placeholder="https://github.com/...">
                    </div>
                    <div class="form-group">
                        <label for="project-startDate">Start Date</label>
                        <input type="date" id="project-startDate">
                    </div>
                    <div class="form-group">
                        <label for="project-endDate">End Date</label>
                        <input type="date" id="project-endDate">
                    </div>
                    <div class="form-group full-width">
                        <label for="project-description">Description</label>
                        <textarea id="project-description" rows="3"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label for="project-highlights">Key Features/Achievements (one per line)</label>
                        <textarea id="project-highlights" rows="4" placeholder="• Built with React and Node.js&#10;• Deployed to AWS&#10;• Used by 1000+ users"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label for="project-keywords">Technologies/Keywords (one per line)</label>
                        <textarea id="project-keywords" rows="3" placeholder="• JavaScript&#10;• React&#10;• Node.js"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-button modal-cancel">Cancel</button>
                <button class="primary-button" id="save-project">Save</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Resume Web Component
        class ResumeJson extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this._resumeData = null;
                this._template = 'basic';
            }

            static get observedAttributes() {
                return ['template', 'data-url'];
            }

            connectedCallback() {
                this.render();
            }

            attributeChangedCallback(name, oldValue, newValue) {
                if (name === 'template') {
                    this._template = newValue;
                    this.render();
                } else if (name === 'data-url') {
                    this.loadDataFromUrl(newValue);
                }
            }

            set resumeData(data) {
                this._resumeData = data;
                this.render();
            }

            get resumeData() {
                return this._resumeData;
            }

            async loadDataFromUrl(url) {
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    this.resumeData = data;
                } catch (error) {
                    console.error('Error loading resume data:', error);
                }
            }

            render() {
                if (!this._resumeData) return;

                const templateHtml = this.getTemplate(this._template);
                const processedHtml = this.processTemplate(templateHtml, this._resumeData);
                
                this.shadowRoot.innerHTML = `
                    <style>${this.getStyles(this._template)}</style>
                    ${processedHtml}
                `;
            }

            processTemplate(template, data) {
                let html = template;
                
                if (data.basics) {
                    html = html.replace('{{name}}', data.basics.name || '');
                    html = html.replace('{{label}}', data.basics.label || '');
                    html = html.replace('{{email}}', data.basics.email || '');
                    html = html.replace('{{phone}}', data.basics.phone || '');
                    html = html.replace('{{summary}}', data.basics.summary || '');
                    html = html.replace('{{location}}', data.basics.location ? 
                        `${data.basics.location.city}, ${data.basics.location.region}` : '');
                    
                    if (data.basics.profiles) {
                        const profilesHtml = data.basics.profiles.map(p => 
                            `<a href="${p.url}" target="_blank">${p.network}</a>`
                        ).join(' | ');
                        html = html.replace('{{profiles}}', profilesHtml);
                    }
                }
                
                if (data.work) {
                    const workHtml = data.work.map(job => `
                        <div class="work-item">
                            <h3>${job.position} at ${job.name}</h3>
                            <div class="date">${this.formatDate(job.startDate)} - ${job.endDate ? this.formatDate(job.endDate) : 'Present'}</div>
                            <p>${job.summary}</p>
                            ${job.highlights ? `<ul>${job.highlights.map(h => `<li>${h}</li>`).join('')}</ul>` : ''}
                        </div>
                    `).join('');
                    html = html.replace('{{work}}', workHtml);
                }
                
                if (data.education) {
                    const educationHtml = data.education.map(edu => `
                        <div class="education-item">
                            <h3>${edu.studyType} in ${edu.area}</h3>
                            <div class="institution">${edu.institution}</div>
                            <div class="date">${this.formatDate(edu.startDate)} - ${this.formatDate(edu.endDate)}</div>
                        </div>
                    `).join('');
                    html = html.replace('{{education}}', educationHtml);
                }
                
                if (data.skills) {
                    const skillsHtml = data.skills.map(skill => `
                        <div class="skill-group">
                            <h4>${skill.name}</h4>
                            <div class="keywords">${skill.keywords ? skill.keywords.join(', ') : ''}</div>
                        </div>
                    `).join('');
                    html = html.replace('{{skills}}', skillsHtml);
                }
                
                if (data.projects) {
                    const projectsHtml = data.projects.map(project => `
                        <div class="project-item">
                            <h3>${project.name}</h3>
                            <p>${project.description}</p>
                            ${project.highlights ? `<ul>${project.highlights.map(h => `<li>${h}</li>`).join('')}</ul>` : ''}
                            <div class="keywords">${project.keywords ? project.keywords.join(', ') : ''}</div>
                        </div>
                    `).join('');
                    html = html.replace('{{projects}}', projectsHtml);
                }
                
                return html;
            }

            formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
            }

            getTemplate(templateName) {
                const templates = {
                    basic: `
                        <div class="resume-basic">
                            <header>
                                <h1>{{name}}</h1>
                                <h2>{{label}}</h2>
                                <div class="contact">{{email}} | {{phone}} | {{location}}</div>
                                <div class="profiles">{{profiles}}</div>
                            </header>
                            <section class="summary"><h2>Summary</h2><p>{{summary}}</p></section>
                            <section class="work"><h2>Experience</h2>{{work}}</section>
                            <section class="education"><h2>Education</h2>{{education}}</section>
                            <section class="skills"><h2>Skills</h2>{{skills}}</section>
                            <section class="projects"><h2>Projects</h2>{{projects}}</section>
                        </div>
                    `,
                    modern: `
                        <div class="resume-modern">
                            <aside class="sidebar">
                                <h1>{{name}}</h1>
                                <h3>{{label}}</h3>
                                <div class="contact-info">
                                    <div>{{email}}</div>
                                    <div>{{phone}}</div>
                                    <div>{{location}}</div>
                                </div>
                                <div class="profiles">{{profiles}}</div>
                                <section class="skills"><h2>Skills</h2>{{skills}}</section>
                            </aside>
                            <main class="main-content">
                                <section class="summary"><h2>About Me</h2><p>{{summary}}</p></section>
                                <section class="work"><h2>Experience</h2>{{work}}</section>
                                <section class="education"><h2>Education</h2>{{education}}</section>
                                <section class="projects"><h2>Projects</h2>{{projects}}</section>
                            </main>
                        </div>
                    `
                };
                return templates[templateName] || templates.basic;
            }

            getStyles(templateName) {
                const baseStyles = `
                    :host { display: block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    h1, h2, h3, h4 { margin-bottom: 0.5em; }
                    section { margin-bottom: 2em; }
                    ul { margin-left: 20px; }
                    a { color: #0066cc; text-decoration: none; }
                    a:hover { text-decoration: underline; }
                `;

                const templateStyles = {
                    basic: `
                        ${baseStyles}
                        .resume-basic { max-width: 800px; margin: 0 auto; padding: 40px; }
                        header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e0e0e0; }
                        h1 { font-size: 2.5em; margin-bottom: 0.2em; }
                        h2 { font-size: 1.5em; color: #555; font-weight: normal; }
                        section h2 { color: #333; border-bottom: 1px solid #e0e0e0; padding-bottom: 5px; margin-bottom: 15px; }
                        .contact { margin: 10px 0; color: #666; }
                        .work-item, .education-item, .project-item { margin-bottom: 20px; }
                        .date { color: #666; font-style: italic; }
                        .skill-group { margin-bottom: 15px; }
                        .skill-group h4 { color: #444; margin-bottom: 5px; }
                        .keywords { color: #666; }
                    `,
                    modern: `
                        ${baseStyles}
                        .resume-modern { display: flex; min-height: 100vh; }
                        .sidebar { background: #2c3e50; color: white; padding: 40px 30px; width: 300px; }
                        .sidebar h1 { font-size: 2em; margin-bottom: 0.3em; }
                        .sidebar h2 { font-size: 1.2em; margin-top: 30px; margin-bottom: 15px; color: #ecf0f1; }
                        .sidebar h3 { font-size: 1.1em; font-weight: normal; color: #bdc3c7; margin-bottom: 20px; }
                        .contact-info { margin: 20px 0; }
                        .contact-info div { margin: 5px 0; font-size: 0.9em; }
                        .profiles a { color: #3498db; display: block; margin: 5px 0; }
                        .main-content { flex: 1; padding: 40px; }
                        .main-content h2 { color: #2c3e50; font-size: 1.8em; margin-bottom: 20px; }
                        .work-item, .education-item, .project-item { margin-bottom: 25px; }
                        .work-item h3, .project-item h3 { color: #34495e; margin-bottom: 5px; }
                        .date { color: #7f8c8d; font-size: 0.9em; }
                        .skill-group { margin-bottom: 15px; }
                        .skill-group h4 { font-size: 1em; margin-bottom: 5px; color: #ecf0f1; }
                        .keywords { font-size: 0.9em; color: #bdc3c7; }
                    `
                };
                return templateStyles[templateName] || templateStyles.basic;
            }
        }

        // Register the web component
        customElements.define('resume-json', ResumeJson);

        (function() {
            const $ = str => document.querySelector(str);
            const $$ = str => document.querySelectorAll(str);

            // Storage functions
            function loadJobs() {
                const jobsData = localStorage.getItem('saved_jobs');
                return jobsData ? JSON.parse(jobsData) : {};
            }

            function loadSavedResumesList() {
                const savedResumesJson = localStorage.getItem('savedResumes');
                return savedResumesJson ? JSON.parse(savedResumesJson) : {};
            }

            function loadApiLogs() {
                const logsData = localStorage.getItem('api_logs');
                return logsData ? JSON.parse(logsData) : [];
            }

            function saveJobs(jobs) {
                localStorage.setItem('saved_jobs', JSON.stringify(jobs));
            }

            function deleteJob(jobId) {
                const jobs = loadJobs();
                if (jobs[jobId]) {
                    delete jobs[jobId];
                    saveJobs(jobs);
                    return true;
                }
                return false;
            }

            function saveNamedResume(resumeData, name) {
                try {
                    let savedResumes = loadSavedResumesList() || {};
                    const resumeId = `resume_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;
                    
                    savedResumes[name] = {
                        id: resumeId,
                        data: resumeData,
                        timestamp: new Date().toISOString()
                    };
                    
                    localStorage.setItem('savedResumes', JSON.stringify(savedResumes));
                    return resumeId;
                } catch (e) {
                    console.error('Error saving named resume:', e);
                    return false;
                }
            }

            function loadNamedResume(name) {
                try {
                    const savedResumes = loadSavedResumesList();
                    if (!savedResumes || !savedResumes[name]) return null;
                    return savedResumes[name].data;
                } catch (e) {
                    console.error('Error loading named resume:', e);
                    return null;
                }
            }

            function deleteNamedResume(name) {
                try {
                    let savedResumes = loadSavedResumesList() || {};
                    if (savedResumes[name]) {
                        delete savedResumes[name];
                        localStorage.setItem('savedResumes', JSON.stringify(savedResumes));
                        return true;
                    }
                    return false;
                } catch (e) {
                    console.error('Error deleting named resume:', e);
                    return false;
                }
            }

            function loadResumeById(resumeId) {
                try {
                    const savedResumes = loadSavedResumesList();
                    for (const [name, resumeData] of Object.entries(savedResumes)) {
                        if (resumeData.id === resumeId) {
                            return { name, data: resumeData.data };
                        }
                    }
                    return null;
                } catch (e) {
                    console.error('Error loading resume by ID:', e);
                    return null;
                }
            }

            function deleteResumeById(resumeId) {
                try {
                    let savedResumes = loadSavedResumesList() || {};
                    for (const [name, resumeData] of Object.entries(savedResumes)) {
                        if (resumeData.id === resumeId) {
                            delete savedResumes[name];
                            localStorage.setItem('savedResumes', JSON.stringify(savedResumes));
                            return name; // Return the name for confirmation message
                        }
                    }
                    return null;
                } catch (e) {
                    console.error('Error deleting resume by ID:', e);
                    return null;
                }
            }

            // Data loading functions for different categories
            function getDataForCategory(category) {
                switch(category) {
                    case 'resumes':
                        const savedResumes = loadSavedResumesList();
                        return Object.entries(savedResumes).map(([name, resume]) => ({
                            id: resume.id,
                            name: name,
                            timestamp: resume.timestamp,
                            sections: Object.keys(resume.data || {}).length
                        }));
                    
                    case 'jobs':
                        const jobs = loadJobs();
                        return Object.values(jobs).map(job => ({
                            id: job.id,
                            company: job.company || 'Unknown Company',
                            title: job.title || 'Untitled Position',
                            status: job.status,
                            dateCreated: job.dateCreated,
                            dateUpdated: job.dateUpdated,
                            location: job.location
                        }));
                    
                    case 'logs':
                        return loadApiLogs().slice(-20).map(log => ({
                            id: log.timestamp,
                            timestamp: log.timestamp,
                            apiType: log.apiType,
                            success: log.success,
                            error: log.error
                        }));
                    
                    case 'settings':
                        return [
                            { setting: 'Auto-save', value: 'Enabled', type: 'Boolean' },
                            { setting: 'Theme', value: 'Light', type: 'String' },
                            { setting: 'Local Storage', value: 'Available', type: 'Status' }
                        ];
                    
                    default:
                        return [];
                }
            }

            // Default resume structure
            function createDefaultResume() {
                return {
                    basics: {
                        name: '',
                        label: '',
                        email: '',
                        phone: '',
                        website: '',
                        summary: '',
                        location: {
                            address: '',
                            postalCode: '',
                            city: '',
                            countryCode: '',
                            region: ''
                        },
                        profiles: []
                    },
                    work: [],
                    education: [],
                    skills: [],
                    projects: [],
                    volunteer: [],
                    awards: [],
                    publications: [],
                    languages: [],
                    interests: [],
                    references: [],
                    meta: {
                        canonical: '',
                        version: '',
                        lastModified: new Date().toISOString()
                    }
                };
            }

            const app = {
                getData: getDataForCategory,
                state: {
                    loaded: true,
                    selectedCategory: 'resumes',
                    selectedItem: null
                },
                
                init() {
                    this.setupNavigation();
                    this.setupResizing();
                    this.loadCategory('resumes');
                    this.setupModalHandlers();
                    this.currentEditResume = null;
                    this.currentEditIndex = -1; // Track which item is being edited (-1 = new item)
                },

                setupNavigation() {
                    $$('.nav-item').forEach(item => {
                        item.addEventListener('click', (e) => {
                            const category = e.target.dataset.category;
                            this.selectCategory(category);
                        });
                    });
                },

                selectCategory(category) {
                    // Update nav selection
                    $$('.nav-item').forEach(item => item.classList.remove('active'));
                    $(`[data-category="${category}"]`).classList.add('active');
                    
                    this.state.selectedCategory = category;
                    this.state.selectedItem = null;
                    this.loadCategory(category);
                },

                loadCategory(category) {
                    const data = this.getData(category) || [];
                    this.displayList(data, category);
                    $('#detailContent').innerHTML = '<div class="empty-state">Select an item to view details</div>';
                },

                displayList(data, category) {
                    const listContent = $('#listContent');
                    
                    if (!data || data.length === 0) {
                        listContent.innerHTML = '<div class="empty-state">No items found</div>';
                        return;
                    }

                    let html = '';
                    data.forEach((item, index) => {
                        let displayText = '';
                        let subtitle = '';
                        
                        switch(category) {
                            case 'resumes':
                                displayText = item.name;
                                subtitle = `${item.sections} sections • ${new Date(item.timestamp).toLocaleDateString()}`;
                                break;
                            case 'jobs':
                                displayText = `${item.title} at ${item.company}`;
                                subtitle = `${item.status} • ${new Date(item.dateUpdated).toLocaleDateString()}`;
                                break;
                            case 'logs':
                                displayText = `${item.apiType} Call`;
                                subtitle = `${item.success ? 'Success' : 'Failed'} • ${new Date(item.timestamp).toLocaleString()}`;
                                break;
                            default:
                                displayText = item.name || item.setting || `Item ${item.id}`;
                                subtitle = item.value || '';
                        }
                        
                        html += `<div class="list-item" data-index="${index}">
                            <div class="item-title">${displayText}</div>
                            ${subtitle ? `<div class="item-subtitle">${subtitle}</div>` : ''}
                        </div>`;
                    });

                    listContent.innerHTML = html;

                    // Add click handlers to list items
                    $$('.list-item').forEach(item => {
                        item.addEventListener('click', (e) => {
                            // Find the closest list-item element to get the correct index
                            const listItem = e.target.closest('.list-item');
                            const index = parseInt(listItem.dataset.index);
                            this.selectItem(index);
                        });
                    });
                },

                selectItem(index) {
                    // Update list selection
                    $$('.list-item').forEach(item => item.classList.remove('selected'));
                    $(`.list-item[data-index="${index}"]`).classList.add('selected');
                    
                    const data = this.getData(this.state.selectedCategory);
                    const item = data[index];
                    this.state.selectedItem = item;
                    this.displayDetail(item, this.state.selectedCategory);
                },

                displayDetail(item, category) {
                    const detailContent = $('#detailContent');
                    let content = '';
                    
                    switch(category) {
                        case 'resumes':
                            content = this.displayResumeDetail(item);
                            break;
                        case 'jobs':
                            content = this.displayJobDetail(item);
                            break;
                        case 'logs':
                            content = this.displayLogDetail(item);
                            break;
                        default:
                            content = this.display([item]);
                    }
                    
                    detailContent.innerHTML = content;
                },

                displayResumeDetail(resume) {
                    return `
                        <div class="detail-section">
                            <h3>Resume: ${resume.name}</h3>
                            <p><strong>Created:</strong> ${new Date(resume.timestamp).toLocaleString()}</p>
                            <p><strong>Sections:</strong> ${resume.sections}</p>
                            <p><strong>ID:</strong> ${resume.id}</p>
                            <div class="action-buttons">
                                <button class="primary-button btn-sm" onclick="app.editResumeById('${resume.id}')">Edit Resume</button>
                                <button class="secondary-button btn-sm" onclick="app.deleteResumeById('${resume.id}')">Delete</button>
                                <button class="secondary-button btn-sm" onclick="app.duplicateResumeById('${resume.id}')">Duplicate</button>
                            </div>
                        </div>
                    `;
                },

                displayJobDetail(job) {
                    const coverLetterBtn = job.coverLetter ? 
                        `<button class="secondary-button btn-sm" onclick="app.viewCoverLetter('${job.id}')">View Cover Letter</button>` : '';
                    const resumeBtn = job.resumeId ? 
                        `<button class="secondary-button btn-sm" onclick="app.viewTailoredResume('${job.resumeId}')">View Tailored Resume</button>` : '';
                    
                    return `
                        <div class="detail-section">
                            <h3>${job.title}</h3>
                            <p><strong>Company:</strong> ${job.company}</p>
                            <p><strong>Status:</strong> <span class="status-${job.status}">${job.status}</span></p>
                            <p><strong>Location:</strong> ${job.location || 'Not specified'}</p>
                            <p><strong>Created:</strong> ${new Date(job.dateCreated).toLocaleString()}</p>
                            <p><strong>Updated:</strong> ${new Date(job.dateUpdated).toLocaleString()}</p>
                            ${job.resumeId ? `<p><strong>Has Tailored Resume:</strong> Yes</p>` : ''}
                            ${job.coverLetter ? `<p><strong>Has Cover Letter:</strong> Yes</p>` : ''}
                            <p><strong>ID:</strong> ${job.id}</p>
                            <div class="action-buttons">
                                <button class="primary-button btn-sm" onclick="app.tailorResumeForJob('${job.id}')">Tailor Resume</button>
                                ${resumeBtn}
                                ${coverLetterBtn}
                                <button class="secondary-button btn-sm" onclick="app.editJob('${job.id}')">Edit Job</button>
                                <button class="secondary-button btn-sm" onclick="app.deleteJob('${job.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                },

                displayLogDetail(log) {
                    return `
                        <div class="detail-section">
                            <h3>API Call: ${log.apiType}</h3>
                            <p><strong>Time:</strong> ${new Date(log.timestamp).toLocaleString()}</p>
                            <p><strong>Status:</strong> <span class="${log.success ? 'status-success' : 'status-error'}">${log.success ? 'Success' : 'Failed'}</span></p>
                            ${log.error ? `<p><strong>Error:</strong> ${log.error}</p>` : ''}
                        </div>
                    `;
                },

                display(data, tgt) {
                    if (!data || data.length === 0) return '';
                    
                    let out = "<table><thead><tr>";
                    const keys = Object.keys(data[0]);
                    if (keys) {
                        keys.forEach(key => {
                            out += `<th>${key}</th>`;
                        });
                    }
                    out += "</tr></thead><tbody>";
                    data.forEach(item => {
                        out += `<tr>`;
                        keys.forEach(key => {
                            out += `<td>${item[key]}</td>`;
                        });
                        out += `</tr>`;
                    });
                    out += "</tbody></table>";

                    if (tgt) {
                        tgt.innerHTML = out;
                    }
                    return out;
                },

                setupModalHandlers() {
                    // Modal close handlers
                    $$('.modal-close').forEach(btn => {
                        btn.addEventListener('click', () => {
                            btn.closest('.modal-backdrop').classList.add('hidden');
                        });
                    });
                    
                    $$('.modal-cancel').forEach(btn => {
                        btn.addEventListener('click', () => {
                            btn.closest('.modal-backdrop').classList.add('hidden');
                        });
                    });
                    
                    // Tab switching in modal
                    $$('.tab').forEach(tab => {
                        tab.addEventListener('click', () => {
                            const tabId = tab.dataset.tab;
                            if (tabId) {
                                this.switchModalTab(tabId);
                            }
                        });
                    });
                    
                    // Save resume changes
                    $('#save-resume-changes')?.addEventListener('click', () => {
                        this.saveResumeChanges();
                    });
                    
                    // Save settings
                    $('#save-settings')?.addEventListener('click', () => {
                        this.saveSettingsFromModal();
                    });
                    
                    // Tailor resume button
                    $('#tailor-resume-btn')?.addEventListener('click', () => {
                        this.processTailorRequest();
                    });
                    
                    // Copy cover letter
                    $('#copy-cover-letter')?.addEventListener('click', () => {
                        this.copyCoverLetterToClipboard();
                    });
                    
                    // Template selector change
                    $('#template-select')?.addEventListener('change', (e) => {
                        const previewComponent = $('#resume-preview');
                        if (previewComponent) {
                            previewComponent.setAttribute('template', e.target.value);
                        }
                    });
                    
                    // Auto-update preview when basic fields change
                    const previewFields = ['resume-name', 'resume-label', 'resume-email', 'resume-phone', 'resume-website', 'resume-city', 'resume-region', 'resume-summary'];
                    previewFields.forEach(fieldId => {
                        $(`#${fieldId}`)?.addEventListener('input', () => {
                            if ($('#preview-panel').classList.contains('active')) {
                                this.updatePreview();
                            }
                        });
                    });
                    
                    // Setup event delegation for edit/delete buttons in resume sections
                    this.setupSectionEventDelegation();
                    
                    // Setup modal save handlers
                    this.setupModalSaveHandlers();
                    
                    // Setup add button handlers
                    this.setupAddButtonHandlers();
                },

                // Modal management functions
                showModal(modalId) {
                    const modal = $(`#${modalId}`);
                    if (modal) {
                        modal.classList.remove('hidden');
                        
                        // Focus the first input field if present
                        setTimeout(() => {
                            const firstInput = modal.querySelector('input, textarea, select');
                            if (firstInput) {
                                firstInput.focus();
                            }
                        }, 100);
                    }
                },

                hideModal(modalId) {
                    const modal = $(`#${modalId}`);
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                },

                clearModalFields(modalId) {
                    const modal = $(`#${modalId}`);
                    if (!modal) return;
                    
                    modal.querySelectorAll('input, textarea, select').forEach(input => {
                        if (input.type === 'checkbox') {
                            input.checked = false;
                        } else {
                            input.value = '';
                        }
                    });
                },

                setupAddButtonHandlers() {
                    // Add work button
                    $('#add-work')?.addEventListener('click', () => {
                        this.currentEditIndex = -1; // -1 means adding new item
                        this.clearModalFields('work-modal');
                        $('.modal-title', '#work-modal').textContent = 'Add Work Experience';
                        this.showModal('work-modal');
                    });

                    // Add education button
                    $('#add-education')?.addEventListener('click', () => {
                        this.currentEditIndex = -1;
                        this.clearModalFields('education-modal');
                        $('.modal-title', '#education-modal').textContent = 'Add Education';
                        this.showModal('education-modal');
                    });

                    // Add skill button
                    $('#add-skill')?.addEventListener('click', () => {
                        this.currentEditIndex = -1;
                        this.clearModalFields('skills-modal');
                        $('.modal-title', '#skills-modal').textContent = 'Add Skill';
                        this.showModal('skills-modal');
                    });

                    // Add project button
                    $('#add-project')?.addEventListener('click', () => {
                        this.currentEditIndex = -1;
                        this.clearModalFields('projects-modal');
                        $('.modal-title', '#projects-modal').textContent = 'Add Project';
                        this.showModal('projects-modal');
                    });
                },

                setupModalSaveHandlers() {
                    // Work modal save handler
                    $('#save-work')?.addEventListener('click', () => {
                        const name = $('#work-name').value.trim();
                        const position = $('#work-position').value.trim();
                        const startDate = $('#work-startDate').value.trim();
                        const endDate = $('#work-endDate').value.trim();
                        const url = $('#work-url').value.trim();
                        const location = $('#work-location').value.trim();
                        const summary = $('#work-summary').value.trim();
                        const highlightsText = $('#work-highlights').value.trim();
                        
                        if (!name || !position) {
                            alert('Company name and position are required');
                            return;
                        }
                        
                        // Process highlights as array of strings
                        const highlights = highlightsText 
                            ? highlightsText.split('\n')
                                .map(h => h.trim())
                                .filter(h => h.length > 0)
                                .map(h => h.startsWith('• ') ? h.substring(2) : h)
                            : [];
                        
                        const workData = {
                            name, position, startDate, endDate, url, location, summary, highlights
                        };
                        
                        if (this.currentEditIndex >= 0) {
                            // Edit existing work
                            this.currentResumeData.work[this.currentEditIndex] = workData;
                        } else {
                            // Add new work
                            if (!this.currentResumeData.work) this.currentResumeData.work = [];
                            this.currentResumeData.work.push(workData);
                        }
                        
                        this.updateWorkSection();
                        this.updatePreview();
                        this.hideModal('work-modal');
                    });

                    // Education modal save handler
                    $('#save-education')?.addEventListener('click', () => {
                        const institution = $('#education-institution').value.trim();
                        const studyType = $('#education-studyType').value.trim();
                        const area = $('#education-area').value.trim();
                        const startDate = $('#education-startDate').value.trim();
                        const endDate = $('#education-endDate').value.trim();
                        const score = $('#education-score').value.trim();
                        const url = $('#education-url').value.trim();
                        const coursesText = $('#education-courses').value.trim();
                        
                        if (!institution || !studyType) {
                            alert('Institution and Study Type are required');
                            return;
                        }
                        
                        // Process courses as array of strings
                        const courses = coursesText 
                            ? coursesText.split('\n')
                                .map(c => c.trim())
                                .filter(c => c.length > 0)
                                .map(c => c.startsWith('• ') ? c.substring(2) : c)
                            : [];
                        
                        const educationData = {
                            institution, studyType, area, startDate, endDate, score, url, courses
                        };
                        
                        if (this.currentEditIndex >= 0) {
                            // Edit existing education
                            this.currentResumeData.education[this.currentEditIndex] = educationData;
                        } else {
                            // Add new education
                            if (!this.currentResumeData.education) this.currentResumeData.education = [];
                            this.currentResumeData.education.push(educationData);
                        }
                        
                        this.updateEducationSection();
                        this.updatePreview();
                        this.hideModal('education-modal');
                    });

                    // Skills modal save handler
                    $('#save-skill')?.addEventListener('click', () => {
                        const name = $('#skill-name').value.trim();
                        const level = $('#skill-level').value.trim();
                        const keywordsText = $('#skill-keywords').value.trim();
                        
                        if (!name) {
                            alert('Skill name is required');
                            return;
                        }
                        
                        // Process keywords as array of strings
                        const keywords = keywordsText 
                            ? keywordsText.split('\n')
                                .map(k => k.trim())
                                .filter(k => k.length > 0)
                                .map(k => k.startsWith('• ') ? k.substring(2) : k)
                            : [];
                        
                        const skillData = {
                            name, level, keywords
                        };
                        
                        if (this.currentEditIndex >= 0) {
                            // Edit existing skill
                            this.currentResumeData.skills[this.currentEditIndex] = skillData;
                        } else {
                            // Add new skill
                            if (!this.currentResumeData.skills) this.currentResumeData.skills = [];
                            this.currentResumeData.skills.push(skillData);
                        }
                        
                        this.updateSkillsSection();
                        this.updatePreview();
                        this.hideModal('skills-modal');
                    });

                    // Projects modal save handler
                    $('#save-project')?.addEventListener('click', () => {
                        const name = $('#project-name').value.trim();
                        const url = $('#project-url').value.trim();
                        const startDate = $('#project-startDate').value.trim();
                        const endDate = $('#project-endDate').value.trim();
                        const description = $('#project-description').value.trim();
                        const highlightsText = $('#project-highlights').value.trim();
                        const keywordsText = $('#project-keywords').value.trim();
                        
                        if (!name) {
                            alert('Project name is required');
                            return;
                        }
                        
                        // Process highlights as array of strings
                        const highlights = highlightsText 
                            ? highlightsText.split('\n')
                                .map(h => h.trim())
                                .filter(h => h.length > 0)
                                .map(h => h.startsWith('• ') ? h.substring(2) : h)
                            : [];
                        
                        // Process keywords as array of strings
                        const keywords = keywordsText 
                            ? keywordsText.split('\n')
                                .map(k => k.trim())
                                .filter(k => k.length > 0)
                                .map(k => k.startsWith('• ') ? k.substring(2) : k)
                            : [];
                        
                        const projectData = {
                            name, url, startDate, endDate, description, highlights, keywords
                        };
                        
                        if (this.currentEditIndex >= 0) {
                            // Edit existing project
                            this.currentResumeData.projects[this.currentEditIndex] = projectData;
                        } else {
                            // Add new project
                            if (!this.currentResumeData.projects) this.currentResumeData.projects = [];
                            this.currentResumeData.projects.push(projectData);
                        }
                        
                        this.updateProjectsSection();
                        this.updatePreview();
                        this.hideModal('projects-modal');
                    });
                },

                setupSectionEventDelegation() {
                    // Event delegation for work section
                    $('#work-list')?.addEventListener('click', (e) => {
                        if (e.target.closest('.edit-item')) {
                            const button = e.target.closest('.edit-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && this.currentResumeData?.work?.[index]) {
                                this.editWorkItem(index);
                            }
                        } else if (e.target.closest('.delete-item')) {
                            const button = e.target.closest('.delete-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && confirm('Are you sure you want to delete this work item?')) {
                                if (this.currentResumeData?.work) {
                                    this.currentResumeData.work.splice(index, 1);
                                    this.updateWorkSection();
                                    this.updatePreview();
                                }
                            }
                        }
                    });

                    // Event delegation for education section
                    $('#education-list')?.addEventListener('click', (e) => {
                        if (e.target.closest('.edit-item')) {
                            const button = e.target.closest('.edit-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && this.currentResumeData?.education?.[index]) {
                                this.editEducationItem(index);
                            }
                        } else if (e.target.closest('.delete-item')) {
                            const button = e.target.closest('.delete-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && confirm('Are you sure you want to delete this education item?')) {
                                if (this.currentResumeData?.education) {
                                    this.currentResumeData.education.splice(index, 1);
                                    this.updateEducationSection();
                                    this.updatePreview();
                                }
                            }
                        }
                    });

                    // Event delegation for skills section
                    $('#skills-list')?.addEventListener('click', (e) => {
                        if (e.target.closest('.edit-item')) {
                            const button = e.target.closest('.edit-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && this.currentResumeData?.skills?.[index]) {
                                this.editSkillItem(index);
                            }
                        } else if (e.target.closest('.delete-item')) {
                            const button = e.target.closest('.delete-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && confirm('Are you sure you want to delete this skill item?')) {
                                if (this.currentResumeData?.skills) {
                                    this.currentResumeData.skills.splice(index, 1);
                                    this.updateSkillsSection();
                                    this.updatePreview();
                                }
                            }
                        }
                    });

                    // Event delegation for projects section
                    $('#projects-list')?.addEventListener('click', (e) => {
                        if (e.target.closest('.edit-item')) {
                            const button = e.target.closest('.edit-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && this.currentResumeData?.projects?.[index]) {
                                this.editProjectItem(index);
                            }
                        } else if (e.target.closest('.delete-item')) {
                            const button = e.target.closest('.delete-item');
                            const index = parseInt(button.dataset.index);
                            if (!isNaN(index) && confirm('Are you sure you want to delete this project item?')) {
                                if (this.currentResumeData?.projects) {
                                    this.currentResumeData.projects.splice(index, 1);
                                    this.updateProjectsSection();
                                    this.updatePreview();
                                }
                            }
                        }
                    });
                },

                // Edit item functions
                editWorkItem(index) {
                    const work = this.currentResumeData.work[index];
                    if (!work) return;
                    
                    // Populate form fields
                    $('#work-name').value = work.name || '';
                    $('#work-position').value = work.position || '';
                    $('#work-startDate').value = work.startDate || '';
                    $('#work-endDate').value = work.endDate || '';
                    $('#work-url').value = work.url || '';
                    $('#work-location').value = work.location || '';
                    $('#work-summary').value = work.summary || '';
                    $('#work-highlights').value = work.highlights ? work.highlights.map(h => `• ${h}`).join('\n') : '';
                    
                    this.currentEditIndex = index;
                    $('.modal-title', '#work-modal').textContent = 'Edit Work Experience';
                    this.showModal('work-modal');
                },

                editEducationItem(index) {
                    const education = this.currentResumeData.education[index];
                    if (!education) return;
                    
                    // Populate form fields
                    $('#education-institution').value = education.institution || '';
                    $('#education-studyType').value = education.studyType || '';
                    $('#education-area').value = education.area || '';
                    $('#education-score').value = education.score || '';
                    $('#education-startDate').value = education.startDate || '';
                    $('#education-endDate').value = education.endDate || '';
                    $('#education-url').value = education.url || '';
                    $('#education-courses').value = education.courses ? education.courses.map(c => `• ${c}`).join('\n') : '';
                    
                    this.currentEditIndex = index;
                    $('.modal-title', '#education-modal').textContent = 'Edit Education';
                    this.showModal('education-modal');
                },

                editSkillItem(index) {
                    const skill = this.currentResumeData.skills[index];
                    if (!skill) return;
                    
                    // Populate form fields
                    $('#skill-name').value = skill.name || '';
                    $('#skill-level').value = skill.level || '';
                    $('#skill-keywords').value = skill.keywords ? skill.keywords.map(k => `• ${k}`).join('\n') : '';
                    
                    this.currentEditIndex = index;
                    $('.modal-title', '#skills-modal').textContent = 'Edit Skill';
                    this.showModal('skills-modal');
                },

                editProjectItem(index) {
                    const project = this.currentResumeData.projects[index];
                    if (!project) return;
                    
                    // Populate form fields
                    $('#project-name').value = project.name || '';
                    $('#project-url').value = project.url || '';
                    $('#project-startDate').value = project.startDate || '';
                    $('#project-endDate').value = project.endDate || '';
                    $('#project-description').value = project.description || '';
                    $('#project-highlights').value = project.highlights ? project.highlights.map(h => `• ${h}`).join('\n') : '';
                    $('#project-keywords').value = project.keywords ? project.keywords.map(k => `• ${k}`).join('\n') : '';
                    
                    this.currentEditIndex = index;
                    $('.modal-title', '#projects-modal').textContent = 'Edit Project';
                    this.showModal('projects-modal');
                },

                switchModalTab(tabId) {
                    // Update tab active state
                    $$('.tab').forEach(tab => {
                        if (tab.dataset.tab === tabId) {
                            tab.classList.add('active');
                            tab.setAttribute('aria-selected', 'true');
                        } else {
                            tab.classList.remove('active');
                            tab.setAttribute('aria-selected', 'false');
                        }
                    });
                    
                    // Hide all panels
                    $$('.panel').forEach(panel => panel.classList.remove('active'));
                    
                    // Show selected panel
                    $(`#${tabId}-panel`)?.classList.add('active');
                    
                    // Update preview if switching to preview tab
                    if (tabId === 'preview') {
                        this.updatePreview();
                    }
                },

                editResumeById(resumeId) {
                    const resume = loadResumeById(resumeId);
                    if (!resume) {
                        alert('Resume not found');
                        return;
                    }
                    
                    this.currentEditResume = resume.name;
                    this.currentEditResumeId = resumeId;
                    this.populateResumeForm(resume.data);
                    $('#resume-edit-modal').classList.remove('hidden');
                },

                createNewResume() {
                    const defaultData = createDefaultResume();
                    this.currentEditResume = null;
                    this.currentEditResumeId = null;
                    this.populateResumeForm(defaultData);
                    $('#resume-edit-modal').classList.remove('hidden');
                },

                populateResumeForm(resumeData) {
                    // Populate basics fields
                    $('#resume-name').value = resumeData.basics?.name || '';
                    $('#resume-label').value = resumeData.basics?.label || '';
                    $('#resume-email').value = resumeData.basics?.email || '';
                    $('#resume-phone').value = resumeData.basics?.phone || '';
                    $('#resume-website').value = resumeData.basics?.website || '';
                    $('#resume-city').value = resumeData.basics?.location?.city || '';
                    $('#resume-region').value = resumeData.basics?.location?.region || '';
                    $('#resume-summary').value = resumeData.basics?.summary || '';
                    
                    // Store the current resume data for editing
                    this.currentResumeData = resumeData;
                    
                    // Render section lists
                    this.renderWorkList(resumeData.work || []);
                    this.renderEducationList(resumeData.education || []);
                    this.renderSkillsList(resumeData.skills || []);
                    this.renderProjectsList(resumeData.projects || []);
                    
                    // Update preview
                    this.updatePreview();
                },

                renderWorkList(workData) {
                    const container = $('#work-list');
                    if (!workData || workData.length === 0) {
                        container.innerHTML = '<div class="section-empty">No work experience added yet. Click "Add Experience" to get started.</div>';
                        return;
                    }
                    
                    container.innerHTML = '';
                    workData.forEach((work, index) => {
                        const item = document.createElement('div');
                        item.className = 'section-item';
                        item.innerHTML = `
                            <div class="section-item-content">
                                <div class="section-item-title">${work.position || 'Position'} at ${work.name || 'Company'}</div>
                                <div class="section-item-subtitle">${work.startDate || ''} - ${work.endDate || 'Present'}</div>
                                <div class="section-item-description">${(work.summary || '').substring(0, 100)}${work.summary && work.summary.length > 100 ? '...' : ''}</div>
                            </div>
                            <div class="section-item-actions">
                                <button class="icon-button edit-item" data-index="${index}" title="Edit">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                                <button class="icon-button delete-item" data-index="${index}" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        `;
                        container.appendChild(item);
                    });
                },

                renderEducationList(educationData) {
                    const container = $('#education-list');
                    if (!educationData || educationData.length === 0) {
                        container.innerHTML = '<div class="section-empty">No education added yet. Click "Add Education" to get started.</div>';
                        return;
                    }
                    
                    container.innerHTML = '';
                    educationData.forEach((edu, index) => {
                        const item = document.createElement('div');
                        item.className = 'section-item';
                        item.innerHTML = `
                            <div class="section-item-content">
                                <div class="section-item-title">${edu.studyType || 'Degree'} in ${edu.area || 'Field'}</div>
                                <div class="section-item-subtitle">${edu.institution || 'Institution'}</div>
                                <div class="section-item-description">${edu.startDate || ''} - ${edu.endDate || ''}</div>
                            </div>
                            <div class="section-item-actions">
                                <button class="icon-button edit-item" data-index="${index}" title="Edit">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                                <button class="icon-button delete-item" data-index="${index}" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        `;
                        container.appendChild(item);
                    });
                },

                renderSkillsList(skillsData) {
                    const container = $('#skills-list');
                    if (!skillsData || skillsData.length === 0) {
                        container.innerHTML = '<div class="section-empty">No skills added yet. Click "Add Skill" to get started.</div>';
                        return;
                    }
                    
                    container.innerHTML = '';
                    skillsData.forEach((skill, index) => {
                        const item = document.createElement('div');
                        item.className = 'section-item';
                        item.innerHTML = `
                            <div class="section-item-content">
                                <div class="section-item-title">${skill.name || 'Skill'}</div>
                                <div class="section-item-subtitle">Level: ${skill.level || 'Not specified'}</div>
                                <div class="section-item-description">${skill.keywords ? skill.keywords.join(', ') : ''}</div>
                            </div>
                            <div class="section-item-actions">
                                <button class="icon-button edit-item" data-index="${index}" title="Edit">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                                <button class="icon-button delete-item" data-index="${index}" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        `;
                        container.appendChild(item);
                    });
                },

                renderProjectsList(projectsData) {
                    const container = $('#projects-list');
                    if (!projectsData || projectsData.length === 0) {
                        container.innerHTML = '<div class="section-empty">No projects added yet. Click "Add Project" to get started.</div>';
                        return;
                    }
                    
                    container.innerHTML = '';
                    projectsData.forEach((project, index) => {
                        const item = document.createElement('div');
                        item.className = 'section-item';
                        item.innerHTML = `
                            <div class="section-item-content">
                                <div class="section-item-title">${project.name || 'Project'}</div>
                                <div class="section-item-subtitle">${project.startDate || ''} - ${project.endDate || 'Ongoing'}</div>
                                <div class="section-item-description">${(project.description || '').substring(0, 100)}${project.description && project.description.length > 100 ? '...' : ''}</div>
                            </div>
                            <div class="section-item-actions">
                                <button class="icon-button edit-item" data-index="${index}" title="Edit">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                                <button class="icon-button delete-item" data-index="${index}" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        `;
                        container.appendChild(item);
                    });
                },

                updatePreview() {
                    const resumeData = this.collectResumeData();
                    const previewComponent = $('#resume-preview');
                    if (previewComponent) {
                        previewComponent.resumeData = resumeData;
                    }
                },

                collectResumeData() {
                    return {
                        basics: {
                            name: $('#resume-name').value,
                            label: $('#resume-label').value,
                            email: $('#resume-email').value,
                            phone: $('#resume-phone').value,
                            website: $('#resume-website').value,
                            summary: $('#resume-summary').value,
                            location: {
                                city: $('#resume-city').value,
                                region: $('#resume-region').value
                            },
                            profiles: this.currentResumeData?.basics?.profiles || []
                        },
                        work: this.currentResumeData?.work || [],
                        education: this.currentResumeData?.education || [],
                        skills: this.currentResumeData?.skills || [],
                        projects: this.currentResumeData?.projects || [],
                        volunteer: this.currentResumeData?.volunteer || [],
                        awards: this.currentResumeData?.awards || [],
                        publications: this.currentResumeData?.publications || [],
                        languages: this.currentResumeData?.languages || [],
                        interests: this.currentResumeData?.interests || [],
                        references: this.currentResumeData?.references || [],
                        meta: {
                            lastModified: new Date().toISOString(),
                            ...(this.currentResumeData?.meta || {})
                        }
                    };
                },

                saveResumeChanges() {
                    const resumeData = this.collectResumeData();
                    
                    let resumeName;
                    if (this.currentEditResume) {
                        // Editing existing resume - keep same name unless user wants to change it
                        resumeName = this.currentEditResume;
                        
                        // If editing by ID, we need to delete the old entry first
                        if (this.currentEditResumeId) {
                            deleteResumeById(this.currentEditResumeId);
                        }
                    } else {
                        // Creating new resume
                        resumeName = prompt('Enter a name for this resume:', (resumeData.basics.name ? resumeData.basics.name + "'s Resume" : 'My Resume'));
                        if (!resumeName) return;
                    }
                    
                    const success = saveNamedResume(resumeData, resumeName);
                    if (success) {
                        $('#resume-edit-modal').classList.add('hidden');
                        this.loadCategory('resumes');
                        alert('Resume saved successfully!');
                    } else {
                        alert('Failed to save resume');
                    }
                },

                deleteResumeById(resumeId) {
                    const resume = loadResumeById(resumeId);
                    if (!resume) {
                        alert('Resume not found');
                        return;
                    }
                    
                    if (!confirm(`Are you sure you want to delete "${resume.name}"?`)) return;
                    
                    const deletedName = deleteResumeById(resumeId);
                    if (deletedName) {
                        this.loadCategory('resumes');
                        $('#detailContent').innerHTML = '<div class="empty-state">Select an item to view details</div>';
                        alert('Resume deleted successfully!');
                    } else {
                        alert('Failed to delete resume');
                    }
                },

                duplicateResumeById(resumeId) {
                    const resume = loadResumeById(resumeId);
                    if (!resume) {
                        alert('Resume not found');
                        return;
                    }
                    
                    const newName = prompt('Enter a name for the duplicate:', resume.name + ' (Copy)');
                    if (!newName) return;
                    
                    const success = saveNamedResume(resume.data, newName);
                    if (success) {
                        this.loadCategory('resumes');
                        alert('Resume duplicated successfully!');
                    } else {
                        alert('Failed to duplicate resume');
                    }
                },

                // Settings management
                loadSettings() {
                    const settings = localStorage.getItem('resumeEditorSettings');
                    return settings ? JSON.parse(settings) : {};
                },

                saveSettings(settings) {
                    localStorage.setItem('resumeEditorSettings', JSON.stringify(settings));
                },

                openSettingsModal() {
                    const settings = this.loadSettings();
                    $('#api-service').value = settings.apiService || '';
                    $('#api-key').value = settings.apiKey || '';
                    $('#use-direct-api').checked = settings.useDirectApi !== false;
                    $('#settings-modal').classList.remove('hidden');
                },

                saveSettingsFromModal() {
                    const settings = {
                        apiService: $('#api-service').value,
                        apiKey: $('#api-key').value,
                        useDirectApi: $('#use-direct-api').checked
                    };
                    this.saveSettings(settings);
                    $('#settings-modal').classList.add('hidden');
                    alert('Settings saved successfully!');
                },

                // Job tailoring workflow
                openTailorModal() {
                    $('#job-title').value = '';
                    $('#job-company').value = '';
                    $('#job-description').value = '';
                    
                    const settings = this.loadSettings();
                    if (!settings.apiService || !settings.apiKey) {
                        $('#api-warning').style.display = 'block';
                    } else {
                        $('#api-warning').style.display = 'none';
                    }
                    
                    $('#jobs-modal').classList.remove('hidden');
                },

                tailorResumeForJob(jobId) {
                    const jobs = loadJobs();
                    const job = jobs[jobId];
                    if (!job) {
                        alert('Job not found');
                        return;
                    }
                    
                    $('#job-title').value = job.title || '';
                    $('#job-company').value = job.company || '';
                    $('#job-description').value = job.description || '';
                    
                    this.openTailorModal();
                },

                async processTailorRequest() {
                    const jobTitle = $('#job-title').value.trim();
                    const jobCompany = $('#job-company').value.trim();
                    const jobDescription = $('#job-description').value.trim();
                    
                    if (!jobTitle || !jobCompany || !jobDescription) {
                        alert('Please fill in all fields');
                        return;
                    }
                    
                    const settings = this.loadSettings();
                    if (!settings.apiService || !settings.apiKey) {
                        alert('Please configure your API settings first');
                        return;
                    }
                    
                    const btn = $('#tailor-resume-btn');
                    btn.textContent = 'Processing...';
                    btn.classList.add('loading');
                    btn.disabled = true;
                    
                    try {
                        // Get current resume data (for now, use a default one)
                        const resumeData = this.getCurrentResumeData();
                        
                        let result;
                        if (settings.apiService === 'claude') {
                            result = await this.callClaudeAPI(resumeData, jobDescription, jobTitle, jobCompany, settings.apiKey);
                        } else if (settings.apiService === 'chatgpt') {
                            result = await this.callOpenAIAPI(resumeData, jobDescription, jobTitle, jobCompany, settings.apiKey);
                        }
                        
                        if (result) {
                            await this.handleTailorResult(result, jobTitle, jobCompany, jobDescription);
                        }
                    } catch (error) {
                        console.error('Error processing tailor request:', error);
                        alert('Error processing request: ' + error.message);
                    } finally {
                        btn.textContent = 'Tailor Resume';
                        btn.classList.remove('loading');
                        btn.disabled = false;
                    }
                },

                getCurrentResumeData() {
                    // For now, try to get data from the current edited resume or use default
                    const savedResumes = loadSavedResumesList();
                    const resumeNames = Object.keys(savedResumes);
                    
                    if (resumeNames.length > 0) {
                        // Use the first available resume as base
                        return savedResumes[resumeNames[0]].data;
                    }
                    
                    // Return default resume if none exists
                    return createDefaultResume();
                },

                async callClaudeAPI(resumeData, jobDescription, jobTitle, jobCompany, apiKey) {
                    const prompt = this.createTailorPrompt(resumeData, jobDescription, jobTitle, jobCompany);
                    
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-3-sonnet-20240229',
                            max_tokens: 4000,
                            messages: [{
                                role: 'user',
                                content: prompt
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Claude API error: ${response.status} ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    return this.parseAIResponse(data.content[0].text);
                },

                async callOpenAIAPI(resumeData, jobDescription, jobTitle, jobCompany, apiKey) {
                    const prompt = this.createTailorPrompt(resumeData, jobDescription, jobTitle, jobCompany);
                    
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4',
                            messages: [{
                                role: 'user',
                                content: prompt
                            }],
                            max_tokens: 4000
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`OpenAI API error: ${response.status} ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    return this.parseAIResponse(data.choices[0].message.content);
                },

                createTailorPrompt(resumeData, jobDescription, jobTitle, jobCompany) {
                    return `You are a professional resume writer. I need you to tailor my resume for a specific job posting and also create a cover letter.

Current Resume (JSON format):
${JSON.stringify(resumeData, null, 2)}

Job Title: ${jobTitle}
Company: ${jobCompany}
Job Description:
${jobDescription}

Please provide a response in the following JSON format:
{
  "tailoredResume": {
    // Complete tailored resume in JSON Resume schema format
    // Modify the summary, work descriptions, skills, etc. to match the job requirements
    // Keep the same structure but tailor the content
  },
  "coverLetter": "A professional cover letter for this position (plain text format)"
}

Guidelines:
1. Tailor the resume summary to highlight relevant experience for this role
2. Modify work experience descriptions to emphasize skills and achievements relevant to the job
3. Adjust the skills section to prioritize skills mentioned in the job description
4. Keep all factual information accurate - don't invent experience or skills
5. Create a compelling cover letter that connects my background to the job requirements
6. Maintain professional language throughout

Return only the JSON response, no additional text.`;
                },

                parseAIResponse(responseText) {
                    try {
                        // Try to find JSON in the response
                        const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            return JSON.parse(jsonMatch[0]);
                        }
                        throw new Error('No valid JSON found in response');
                    } catch (error) {
                        console.error('Error parsing AI response:', error);
                        throw new Error('Failed to parse AI response');
                    }
                },

                async handleTailorResult(result, jobTitle, jobCompany, jobDescription) {
                    // Save the tailored resume
                    const resumeName = `${jobTitle} at ${jobCompany}`;
                    const resumeId = saveNamedResume(result.tailoredResume, resumeName);
                    
                    // Create/update job entry
                    const job = {
                        id: `job_${Date.now()}`,
                        title: jobTitle,
                        company: jobCompany,
                        description: jobDescription,
                        status: 'saved',
                        dateCreated: new Date().toISOString(),
                        dateUpdated: new Date().toISOString(),
                        resumeId: resumeId,
                        coverLetter: result.coverLetter,
                        location: '',
                        url: '',
                        contactName: '',
                        contactEmail: '',
                        contactPhone: '',
                        notes: '',
                        dateApplied: null,
                        statusHistory: [],
                        logs: []
                    };
                    
                    const jobs = loadJobs();
                    jobs[job.id] = job;
                    saveJobs(jobs);
                    
                    // Close modal and show success
                    $('#jobs-modal').classList.add('hidden');
                    
                    // Refresh data and switch to jobs view
                    this.loadCategory('jobs');
                    
                    alert(`Resume tailored successfully! Created "${resumeName}" resume and job entry.`);
                },

                viewCoverLetter(jobId) {
                    const jobs = loadJobs();
                    const job = jobs[jobId];
                    if (job && job.coverLetter) {
                        $('#cover-letter-content').textContent = job.coverLetter;
                        $('#cover-letter-modal').classList.remove('hidden');
                    } else {
                        alert('No cover letter found for this job');
                    }
                },

                copyCoverLetterToClipboard() {
                    const content = $('#cover-letter-content').textContent;
                    navigator.clipboard.writeText(content).then(() => {
                        alert('Cover letter copied to clipboard!');
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                        alert('Failed to copy cover letter');
                    });
                },

                viewTailoredResume(resumeId) {
                    // Find resume by ID in saved resumes
                    const savedResumes = loadSavedResumesList();
                    for (const [name, resumeData] of Object.entries(savedResumes)) {
                        if (resumeData.id === resumeId) {
                            // Switch to resumes view and show this resume
                            this.loadCategory('resumes');
                            alert(`Found tailored resume: "${name}". Switch to Resumes tab to view it.`);
                            return;
                        }
                    }
                    alert('Tailored resume not found');
                },

                editJob(jobId) {
                    alert('Job editing functionality coming soon! For now, you can delete and recreate the job.');
                },

                deleteJob(jobId) {
                    if (!confirm('Are you sure you want to delete this job?')) return;
                    
                    const success = deleteJob(jobId);
                    if (success) {
                        this.loadCategory('jobs');
                        $('#detailContent').innerHTML = '<div class="empty-state">Select an item to view details</div>';
                        alert('Job deleted successfully!');
                    } else {
                        alert('Failed to delete job');
                    }
                },


                setupResizing() {
                    // Skip resize setup on mobile devices
                    if (window.innerWidth <= 768) {
                        return;
                    }

                    let isResizing = false;
                    let currentHandle = null;

                    const startResize = (e, handle, targetElement) => {
                        isResizing = true;
                        currentHandle = handle;
                        handle.classList.add('resizing');
                        if (handle.id === 'sidebarResize') {
                            document.body.style.cursor = 'col-resize';
                        } else if (handle.id === 'listResize') {
                            document.body.style.cursor = 'row-resize';
                        }
                        e.preventDefault();
                    };

                    const doResize = (e) => {
                        if (!isResizing || !currentHandle) return;

                        if (currentHandle.id === 'sidebarResize') {
                            const rect = currentHandle.parentElement.getBoundingClientRect();
                            const newWidth = e.clientX - rect.left;
                            if (newWidth >= 200 && newWidth <= 500) {
                                $('#sidebar').style.width = `${newWidth}px`;
                            }
                        } else if (currentHandle.id === 'listResize') {
                            const containerRect = $('.content-area').getBoundingClientRect();
                            const newHeight = e.clientY - containerRect.top;
                            const containerHeight = containerRect.height;
                            const newHeightPercent = (newHeight / containerHeight) * 100;
                            if (newHeightPercent >= 20 && newHeightPercent <= 80) {
                                $('#itemList').style.height = `${newHeightPercent}%`;
                            }
                        }
                    };

                    const stopResize = () => {
                        if (!isResizing) return;
                        isResizing = false;
                        if (currentHandle) {
                            currentHandle.classList.remove('resizing');
                            currentHandle = null;
                        }
                        document.body.style.cursor = '';
                    };

                    // Setup resize handles
                    $('#sidebarResize').addEventListener('mousedown', (e) => {
                        startResize(e, e.target, $('#sidebar'));
                    });

                    $('#listResize').addEventListener('mousedown', (e) => {
                        startResize(e, e.target, $('#itemList'));
                    });

                    document.addEventListener('mousemove', doResize);
                    document.addEventListener('mouseup', stopResize);

                    // Show handles on hover
                    $('.sidebar').addEventListener('mouseenter', () => {
                        if (!isResizing) $('#sidebarResize').style.opacity = '0.5';
                    });
                    $('.sidebar').addEventListener('mouseleave', () => {
                        if (!isResizing) $('#sidebarResize').style.opacity = '0';
                    });

                    $('#itemList').addEventListener('mouseenter', () => {
                        if (!isResizing) $('#listResize').style.opacity = '0.5';
                    });
                    $('#itemList').addEventListener('mouseleave', () => {
                        if (!isResizing) $('#listResize').style.opacity = '0';
                    });

                    // Re-setup resizing on window resize if switching from mobile to desktop
                    window.addEventListener('resize', () => {
                        if (window.innerWidth > 768 && !isResizing) {
                            // Reset any inline styles that might conflict
                            if (window.innerWidth > 768) {
                                $('#sidebar').style.width = '';
                                $('#itemList').style.height = '';
                            }
                        }
                    });
                }
            };

            // Add action buttons to list header for different categories
            function updateListHeader(category) {
                const listHeader = $('.list-header');
                switch(category) {
                    case 'resumes':
                        listHeader.innerHTML = `
                            List of Resumes
                            <button class="primary-button btn-sm" onclick="app.createNewResume()" style="float: right;">New Resume</button>
                        `;
                        break;
                    case 'jobs':
                        listHeader.innerHTML = `
                            Job Applications
                            <button class="primary-button btn-sm" onclick="app.openTailorModal()" style="float: right;">Tailor Resume for Job</button>
                        `;
                        break;
                    case 'settings':
                        listHeader.innerHTML = `
                            Settings
                            <button class="primary-button btn-sm" onclick="app.openSettingsModal()" style="float: right;">Configure API</button>
                        `;
                        break;
                    default:
                        listHeader.textContent = 'List of Items';
                }
            }

            // Override loadCategory to update header
            const originalLoadCategory = app.loadCategory;
            app.loadCategory = function(category) {
                updateListHeader(category);
                return originalLoadCategory.call(this, category);
            };

            window.app = app;
            app.init();
        })();
    </script>
</body>
</html>
