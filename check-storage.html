<!DOCTYPE html>
<html>
<head>
    <title>Storage Info</title>
    <style>
        body { font-family: monospace; padding: 20px; max-width: 800px; margin: 0 auto; }
        .info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { color: #27ae60; }
        .warning { color: #e67e22; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üóÑÔ∏è Storage Status Check</h1>
    <div id="info"></div>
    <button onclick="checkStorage()">Check Storage</button>
    <button onclick="requestPersistent()">Request Persistent Storage</button>

    <script>
        async function checkStorage() {
            const info = document.getElementById('info');
            let html = '';

            // Check if storage is persistent
            if (navigator.storage && navigator.storage.persisted) {
                const persistent = await navigator.storage.persisted();
                html += `<div class="info ${persistent ? 'success' : 'warning'}">
                    <strong>Persistent Storage:</strong> ${persistent ? '‚úÖ YES' : '‚ö†Ô∏è NO (data may be evicted)'}<br>
                    ${persistent ? 'Your data is protected from eviction' : 'Request persistent storage to protect your data'}
                </div>`;
            }

            // Check storage quota
            if (navigator.storage && navigator.storage.estimate) {
                const estimate = await navigator.storage.estimate();
                const usedMB = (estimate.usage / 1024 / 1024).toFixed(2);
                const quotaMB = (estimate.quota / 1024 / 1024).toFixed(2);
                const percentUsed = ((estimate.usage / estimate.quota) * 100).toFixed(1);

                html += `<div class="info">
                    <strong>Storage Usage:</strong><br>
                    Used: ${usedMB} MB<br>
                    Quota: ${quotaMB} MB<br>
                    Percent: ${percentUsed}%
                </div>`;
            }

            // Check IndexedDB
            if (window.indexedDB) {
                html += `<div class="info success">
                    <strong>IndexedDB:</strong> ‚úÖ Available
                </div>`;
            }

            // Check what databases exist
            if (indexedDB.databases) {
                const dbs = await indexedDB.databases();
                html += `<div class="info">
                    <strong>Databases:</strong><br>
                    ${dbs.map(db => `‚Ä¢ ${db.name} (v${db.version})`).join('<br>') || 'None found'}
                </div>`;
            }

            info.innerHTML = html;
        }

        async function requestPersistent() {
            if (navigator.storage && navigator.storage.persist) {
                const isPersisted = await navigator.storage.persist();
                alert(isPersisted 
                    ? '‚úÖ Persistent storage granted! Your data is now protected.' 
                    : '‚ö†Ô∏è Persistent storage denied. Browser may evict data under pressure.');
                checkStorage();
            } else {
                alert('Persistent storage API not supported in this browser');
            }
        }

        // Auto-check on load
        window.addEventListener('load', checkStorage);
    </script>
</body>
</html>
